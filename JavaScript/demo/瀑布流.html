<!DOCTYPE html>
<html lang="cn">

<head>
  <title>瀑布流</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    * {
      margin: 0;
      padding: 0;
    }

    li {
      list-style: none;
    }

    #box {
      margin: 0 auto;
      width: 700px;
    }

    ul {
      width: 200px;
      float: left;
      margin: 0 auto;
      margin-right: 10px
    }

    img {
      width: 200px;
      padding-top: 10px;
    }
  </style>

<body>
  <div id="box">
    <ul></ul>
    <ul></ul>
    <ul></ul>
  </div>
</body>
<script src="../JavaScript/ajax.js"></script>
<script>
  /*  window.onload = function () {
    //1.获取页面元素
    let oBox = document.getElementById("box");
    let oUl = document.getElementsByTagName("ul");
    let vH = document.documentElement.clientHeight;
    //2.最小高度的列
    function min_height(oUl) {
      let ht = oUl[0].offsetHeight;
      let index = 0;
      for (let i = 0; i < oUl.length; i++) {
        if (oUl[i].offsetHeight < ht) {
          ht = oUl[i].offsetHeight;
          inxex = i
        }
      }
      return index;
    }
    //3.加载图片
    function loadImg() {
      ajax("../data/pubuliu.json", function (data) {
        data = (new Function("return" + data))();
        for (let i = 0; i < data.length; i++) {
          let oLi = document.createElement("li");
          let oImg = document.createElement("img");
          oImg.src = data[i];
          oLi.appendChild(oImg);
          oUl[min_height(oUl)].appendChild(oLi);
          console.log(min_height(oUl))
        }
      })
    }
    loadImg();
    //4.滚动事件
    document.onscroll = function () {
      let sH = document.documentElement.scrollTop || document.body.scrollTop;
      if (sH + vH > document.body.scrollHeight * 0.8) {
        loadImg();
      }
    }
  } */

  window.onload = function () {
    //1.获取页面元素
    let oBox = document.getElementById("box");
    let oUl = document.getElementsByTagName("ul");
    let vH = document.documentElement.clientHeight;
    //2.最小高度的列
    function min_height(oUl) {
      let ht = oUl[0].scrollHeight;
      let index = 0;
      for (let i = 0; i < oUl.length; i++) {
        if (oUl[i].scrollHeight < ht) {
          ht = oUl[i].scrollHeight;
          index = i;
        }
      }
      return index;
    } //3.加载图片
    function loadImg() {
      ajax("../data/pubuliu.json", function (
        data) {
        data = JSON.parse(data);
        for (let i = 0; i < data.length; i++) {
          let oLi = document.createElement("li");
          let oImg = document.createElement("img");
          oImg.src = data[i];
          oLi.appendChild(oImg);
          console.log(min_height(oUl));
          oUl[min_height(oUl)].appendChild(oLi);
        }
      });
    };
    //4.滚动事件
    document.onscroll = function () {
      let sH = document.documentElement.scrollTop ||
        document.body.scrollTop;
      let docHeigth = Math.max(document.body.scrollHeight, document.documentElement.scrollHeight);
      if (sH + vH > docHeigth * 0.8) {
        loadImg();
      }
    };
    loadImg();
    // document.onclick = function () {
    //   loadImg();
    // }
  };
</script>

</html>